# アーキテクチャの役目

## アンチパターン：利口なUI
利口なUIは本来であればドメインオブジェクトに記載されるべき重要なルールやふるまいが、ユーザーインターフェースに記述されてしまっている状態で、ドメインを分離することが適わなかったアプリケーションに多く見られる。

そうしたシステムは改良に対するコストが異常に高くなってしまう。

## ドメイン駆動設計がアーキテクチャに求めること
利口なUIを避けることを決めたとしても容易ではない。ビジネスロジックを正しい場所に配置し続けることは、いかにその大切さを熟知している開発者であっても難しい。

それゆえ開発車に強い自制心を促す以外の方法を考える必要があり、アーキテクチャはその解決策になる。

アーキテクチャは方針で、何がどこに記述されるべきかといった疑問に対する回答を明確に、ロジックが無秩序に点在することを防ぐ。

開発者はアーキテクチャが示す方針にしたがうことで、「何をどこに書くのか」に振り回されないようになる。これは開発者がドメイン駆動設計の本質である「ドメインをとらえ、うまく表現する」ことに集中するために必要なこと。

ドメイン駆動設計がアーキテクチャに求めることは、ドメインオブジェクトが渦巻くレイヤーを隔離して、ソフトウェア特有の事情からドメインオブジェクトを防衛すること。

それを可能にするのであれば、アーキテクチャがどのようなものであっても構わない。

# アーキテクチャの解説
ドメイン駆動設計と同時に語られることの多いアーキテクチャは以下のとおり。

- レイヤードアーキテクチャ
- ヘキサゴナルアーキテクチャ
- クリーンアーキテクチャ

ドメイン駆動設計にとってはドメインが隔離されることのみが重要であり、必ずしもいずれかのアーキテクチャにしたがわなければいけないというわけではない。

またアーキテクチャにしたがったからといって、それすなわちドメイン駆動設計を実践したことにはならない。重要なのは、ドメインの本質に集中すること。

## レイヤードアーキテクチャ
ドメイン駆動設計の文脈で登場するアーキテクチャの中で、もっとも伝統的で有名なアーキテクチャで、その名のとおりいくつかの層が積み重なる形で表現される。

<img src="./04_レイヤードアーキテクチャ.jpg">

4つの層で構成されたものが代表的で、層の内訳は以下のとおり。

- プレゼンテーション層(ユーザーインターフェース層)
- アプリケーション層
- ドメイン層
- インフラストラクチャ層

### ドメイン層
この中でもっとも重要なそうで、ソフトウェアを適用しようとしている領域で問題解決に必要な知識を表現する。この層を明示的にして、ドメイン層に本来所属すべきドメインオブジェクトの隔離を促し、他の層へ流出しないようにする

### アプリケーション層
ドメイン層の住人を取りまとめる層でアプリケーションサービスが挙げられる。アプリケーションサービスはドメインオブジェクトの直接のクライアントとなり、ユースケースを実現するための進行役になる。

ドメイン層の住人はドメインの表現に徹しているので、アプリケーションとして成り立たせるためには彼らを問題解決に導く必要がある。そのような働きをするアプリケーション層はまさにドメイン層の住人を取りまとめる存在。

### プレゼンテーション層
ユーザーインターフェースとアプリケーションを結びつける。主な責務は表示と解釈で、システムの利用車にわかるように表示を行い、システム利用者の入力を解釈する。

ユーザーインターフェースとアプリケーションを結びつけることさえできれば、WebフレームワークであってもCLIであっても良い。

### インフラストラクチャ層
他の層を支える技術的基盤へのアクセスを提供するそうで、アプリケーションのためのメッセージ送信や、ドメインのための永続化を行うモジュールが含まれる。

### 解説
ここに存在する原則は依存の方向が上から下ということで、上位のレイヤーは自身より下位のレイヤーに依存することが許される。逆方向の直接的な依存は許されない。

ドメイン層からインフラストラクチャ層に依存の矢印が伸ばされているのは、ドメイン層のオブジェクトがインフラストラクチャ層のオブジェクトを取り扱うことを意味していない。

白抜きの矢印で汎化が含まれていることがわかり、リポジトリのインターフェースと実装クラスの関係がこの矢印にあたる。



