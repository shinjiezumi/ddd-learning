# 軽量DDDに陥らないために
ドメイン駆動設計に登場するパターンだけを取り入れる手法は軽量DDDと呼ばれる。

軽量DDDはあくまでもコードの書き方を主題としているので、開発者だけで完結させることが可能で実践しやすく、短期的にある程度の秩序をもたらしてくれる。

しかし、もっとも重要なことはドメインの本質に向き合うことで、技術的なパターンは絶対的な答えとして君臨するものではなく、ドメインの本質に向き合い、それをうまくコードで表現するためのサポート役として機能するもの。

ドメイン駆動設計ではドメインを実装に結びつけるモデリングの手法についても多く語られている。

# ドメインエキスパートとモデリングをする
開発者はドメインエキスパートと呼ばれるドメインの精通者たちと会話をしなくてはならない。ドメインエキスパートはドメインの実践者で、システマティックな表現に変換するよりも、ドメインの概念を捻じ曲げないように共通の言葉でコミュニケーションするように心がけるべき。

ドメインの問題を解決するソフトウェアを開発するにあたって、ドメインと向き合うことは避けられない。

開発者はドメインと向き合うことよりも技術的なアプローチに傾倒しがちでこれは間違っている。ドメインの問題を解決する答えを導き出すにはドメインを知る必要がある。

## 本当に解決すべきものを見つける
ドメインエキスパートとの対話はソフトウェアの方向性を決定するのに有意義だが、開発者がドメインエキスパートへ迎合するように推奨しているわけではない。

真に解決すべき問題は開発者とドメインエキスパートが対話することによって見つけ出されるもの。

開発者はドメインエキスパートと協力して、ドメインにおいて有益な概念を作り上げなくてはならない。そうして作り上げられた概念がドメインモデルと呼ばれているもの。

ドメインエキスパートが保有している知識は膨大だが、どの知識がシステムの役に立つのかまではわからない。それを知るにはシステムによって実現できることに関する知識が必要。

一方で開発者もただドメインエキスパートの言葉を聞くことに徹していてはいけない。開発者には対話してシステムにとって役に立つ概念や知識を引き出す役目がある。

また、世の中にはドメインエキスパートが介在しない(開発者とステークホルダーとの間で決まる)プロジェクトも存在する。 開発者とドメインエキスパートとのコミュニケーションを増やして、介在させることが重要。

## ドメインとコードを結びつけるモデル

ソフトウェア開発の最終成果物はコード。モデルはドメインとコードを結びつけるために存在する。

ドメインとコードはモデルを通じて繋げることができる。そしてお互いに常に行き来することで、ソフトウェアにとって役に立ち、なおかつドメインの知識を凝縮したドメインモデルを手に入れることができる。

# ユビキタス言語

人は皆、言葉によって意思疎通を図る。人間はモノやコト、概念に名前を付け、それに対する認識を共有することで医師の疎通を図ることができる。

もしもひとつの概念に複数の名前が付けらえていたら混乱を引き起こす。避けるべきだが、ソフトウェア開発の現場においては容易に起こる。

たとえばドメインエキスパートは「ユーザーを登録する」と表現しているのに、開発者は「ユーザーを新規保存する」と表現しているなど。

開発者はドメインエキスパートから価値あるドメインモデルを引き出す必要がある。そのためにもドメインエキスパートと同じ言葉で会話をしなくてはならない。

プロジェクトには認識の祖語や翻訳にコストをかけないためにも共通言語を作ることが求められる。そういったプロジェクトにおける共通言語のことをユビキタス言語という。

ユビキタス言語にはプロジェクトのいたるところで使われなくてはならないという意味が込められている。ドメインエキスパートとの会話はもちろん、開発者同士の会話やコードにも現れなければならない。

## 深い洞察を得るために

モデルに対する深い洞察を得るためにはユビキタス言語による会話が重要なファクターとなる。

私たちは自身の母国語でない言葉で会話を行う場合、翻訳を必要とする。集中すべきはその会話の内容であるにもかかわらず、その言葉の意味を考えることに躍起になってしまう。もし同じ言語で会話をしていたならそのコストは存在しない。

ユビキタス言語が十分に浸透していない、あるいは全く使われないプロジェクトは常に翻訳をしている状況。

開発者たちはよくわからないドメインを理解しようと努力するが、ドメインエキスパートの協力を得られない場合は中途半端な理解や誤解を生んでしまう。それが開発チームの中に共有され、最終的にはドメインの概念とはほど遠いオブジェクトとして具現化されてしまう。

中途半端な理解や誤解はプロジェクトが進むにつれて深刻な問題を引き起こしていく。同じコストを支払うのであれば翻訳のコストではなく、プロジェクト共通の言語であるユビキタス言語を策定して維持することにコストを掛けた方がずっと有意義。

ユビキタス言語を使って会話をしていくと、ドメインの概念を伝える際に扱いにくい擁護や曖昧な言葉に気づくことがある。どうして扱いにくいのか、何が曖昧なのかといったことを開発者とドメインエキスパートで指摘し合うことにより、モデルはより深い洞察を持って洗練され、ドメインの知識を語るようになる。

## ユビキタス言語がコードの表現として使われる。

ユビキタス言語は会話はもちろん、ドキュメントや最終的な成果物であるコードにも利用される。

「ユーザーの名前を変更する」という表現がドメインにとって自然な表現であれば、その言葉を忠実にコードで表現すべき。

```php
class User
{
    public function changeName(UserName $name)
    {
        // 省略
    }
}
```

もし開発者が「変更する」という表現を無視し、実装上の仕組みであるデータの更新に着目してしまった場合、コードは更新を推し出す形になってしまう。

```php
class User
{
    public function updateName(UserName $name)
    {
        // 省略
    }
}
```

結果として`User`クラスの定義から「変更する」という表現が消えてしまう。このコードと付き合っていくには、ドメインエキスパートが「名前の変更」と表現するたびに、開発者は意識的に「名前の更新」で表現されているという変換を行う必要がある。

コードがドメインモデルをそのまま表現できていれば、ドメインの変化はそのままコードへ適用できるようになる。よってモデルをコードで表現するときにユビキタス言語を利用することは設計とコードを結びつける大切な作業となる。

# 境界づけられたコンテキスト

サンプルがイマイチなので割愛

# ボトムアップドメイン駆動設計

ものごとに対するアプローチはトップダウンとボトムアップの2つある。

ドメイン駆動設計においてはドメインが主役で、何のソフトウェアを作るのかは二の次。実際にドメインエキスパートが必要と判断したものが誤っていることもある。まずは問題を紐解くことから始めるアプローチ、ボトムアップで考える。

