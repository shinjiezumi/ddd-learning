# ソフトウェア開発の最初の一歩
ソフトウェアを開発するにあたって、まず最初にしなくてはいけない作業はソリューションの構成を決めること。しかし悩みどころが多い。なぜならここでの決定はそのプロダクトを手放さない限り長い付き合いになるため。

## 4つのレイヤーのパッケージ構成
レイヤードアーキテクチャを例にパッケージ分けを考えていく。レイヤードアーキテクチャは次の4つのレイヤーで構成されている。

- プレゼンテーション
- アプリケーション
- ドメイン
- インフラストラクチャ

### ドメインレイヤーのパッケージ構成
ルートパッケージは`Domain`となっているが実際には境界づけられたコンテキストの名称になる。ドメインレイヤーのパッケージ構成は大きく3種類に分けられる。

1つ目の`Domain.Model`パッケージはドメインオブジェクトが配置される。集約を構成するエンティティやオブジェクトはもちろん、集約の生成を担うファクトリやリポジトリ、仕様もここに所属する。

パッケージ分けをする際に、属性に着目すると`Domain.Factory`や`Domain.Repository`といったパッケージを思いつくこともあるが、それはあまり良い考えではない。

`User`にはファクトリやリポジトリがある。ファクトリでオブジェクトは作成され、リポジトリでオブジェクトは再構築される。`User`のコンストラクタは必ずファクトリやリポジトリによって呼び出されることを想定している。

そのことを後続の開発者に気づかせるヒントとするために、のファクトリやリポジトリは`User`と同居する必要がある。

常にそれが正しいことではないが、パッケージを分ける際には属性に着目するのではなく、意味的なまとまりを意識すると良い。

同じ理由で仕様もドメインオブジェクトと同居する。多くなってきたら`Domain.Model.Circle.Specification`と切り出しても良い。

`Domain.Service`パッケージはドメインサービスが配置されるパッケージ。サービスオブジェクトは複数種のドメインオブジェクトを操作することがあるので、中立的なパッケージに配置する。ただし、`UserService`は`User`クラスと密接に関わるサービスオブジェクトなので、`Domain.Model.User`パッケージに含める選択肢は考慮の余地がある。

残りの`Domain.Shared`パッケージは必ずしも必要になるわけではない。このパッケージに配置されている`ISpecification`は他のプロジェクトでも利用できるもので、共通のプロジェクトとして括って、`Domain`がそれに依存する形に仕立てることも可能。

