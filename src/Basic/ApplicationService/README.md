# アプリケーションサービスとは

アプリケーションサービスは、ユースケースを実現するオブジェクト。

例えばユーザー登録が必要なシステムにおいて、「ユーザーを登録する」ユースケースや「ユーザー情報を変更する」ユースケースが必要で、ユーザー機能のアプリケーションサービスはこれらふるまいを定義する。

それらのふるまいは実際にドメインオブジェクトを組み合わせて実行するようなふるまいとなる。

# ユースケースを組み立てる

サンプルととしてSNSのユーザー機能を取り扱う。

利用者はシステムを利用するためにユーザー登録をする必要がある。

利用者は登録したユーザー情報を参照し、場合によっては変更、不要になった際は退会を行うこともできる。

## ドメインオブジェクトを準備する

今回取り扱うユーザーの概念はライフサイクルがあるためエンティティとして実装する。

## ユーザー登録処理を作成する

`UserApplicationService.register`参照

## ユーザー情報取得処理を作成する

`UserApplicationService.get`参照

返却する結果として、ドメインオブジェクトをそのまま戻り値とするか否かの選択は重要。

ドメインオブジェクトを公開する場合、アプリケーションサービスのコードはシンプルになる。

ただ、アプリケーションサービスのクライアントもドメインオブジェクトのメソッドを呼び出すことが可能になってしまい、ドメインオブジェクトに多くの依存が発生してしまう。

そのため、ドメインオブジェクトのふるまいを呼び出すのは、アプリケーションサービスに限定する方が良い。

ドメインオブジェクトを返すのではなく、クライアントにはDTOに移し替えて返却する。

`UserData`参照。

また、`UserData`のコンストラクタに`User`オブジェクトを渡してあげると、`User`オブジェクトの属性が増えても修正量が少なくて済む。

### 煩わしさを減らすために、DTO生成ツールを作るとよい

ドメインオブジェクトを公開する方法に比べ、記述が増えてしまうデメリットがある。

そこでドメインオブジェクトからDTOを自動生成するツールを作ると、デメリットが解消されるのでおすすめ。

## ユーザー情報更新処理を作成する

`UserApplicationService.update`、`UserUpdateCommand`参照

ユーザーの属性が増えた際にシグネチャが変更されてしまうので、コマンドオブジェクトを利用すると属性変更にも強くなる。

コマンドオブジェクトを作ることは間接的にアプリケーションサービスの処理を制御することと同義。

```php
// ユーザー名変更だけ行う
$updateNameCommand = new UserUpdateCommand('id', 'name', null);
$userApplicationService->update($updateNameCommand);

// メールアドレス変更だけ行う
$updateMailAddressCommand = new UserUpdateCommand('id', null, 'hoge@gmail.com');
$userApplicationService->update($updateMailAddressCommand);
```

コマンドオブジェクトは処理のファサードともいえる。

## 退会処理を作成する

`UserApplicationService.delte`参照

退会処理はインスタンスの復元を行い、削除するだけのシンプルな処理。