# エンティティとは

エンティティはドメインモデルを実装したドメインオブジェクトで、値オブジェクトとの違いは、同一性によって識別されるか否か。

例えばシステムのユーザーなど、登録した後にユーザーの情報が変更されてもユーザー自体が変わるわけではない。

これはユーザーが同一性で識別されているためで、これらオブジェクトをエンティティと呼ぶ。

# エンティティの性質

- 可変である
- 同じ属性であっても区別される
- 同一性により区別される

## 可変である

不変である値オブジェクトに対して、エンティティは可変なオブジェクト。

人々がもつ年齢や身長といった属性が変化するように、エンティティの属性は変化することが許容されている。

以下はユーザー名を変更するケース。

```php
class User
{
    private string $name;

    public function __construct(string $name)
    {
        $this->changeName($name);
    }

    public function changeName(string $name)
    {
        if (mb_strlen($name) < 3) {
            throw new \InvalidArgumentException("invalid name");
        }

        $this->name = $name;
    }
```

`changeName`メソッドを通じて名前を表す属性を変更でき、メソッド名によりそのふるまいが何であるかが語られ、ガード節によって異常な値が設定されることはない。

値オブジェクトは不変の性質があるため交換(代入)によって変更を実現していたが、エンティティは交換による変更を行わない。

エンティティの属性を変化させたい時は、その振る舞いを通じて属性を変更する。

なお、全ての属性を可変にする必要はなく、あくまで必要に応じて可変にすることが許されているだけ。

可変なオブジェクトは厄介な存在なので可能な限り不変にしておくことが良い。
